<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.icpay.payment.db.dao.mybatis.mapper.DailyProfitResultViewMapper">
  <resultMap id="BaseResultMap" type="com.icpay.payment.db.dao.mybatis.model.DailyProfitResultView">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <constructor>
      <arg column="settle_date" javaType="java.lang.String" jdbcType="CHAR" />
      <arg column="chnl_id" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="mchnt_cd" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="mchnt_cn_nm" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="txn_amt_sum" javaType="java.math.BigDecimal" jdbcType="DECIMAL" />
      <arg column="agent_profit" javaType="java.math.BigDecimal" jdbcType="DECIMAL" />
    </constructor>
  </resultMap>
  <sql id="Example_Where_Clause">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <where>
      <foreach collection="oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    `settle_date`, `chnl_id`, `mchnt_cd`, `mchnt_cn_nm`, `txn_amt_sum`, `agent_profit`
  </sql>
  <select id="selectByExample" parameterType="com.icpay.payment.db.dao.mybatis.model.DailyProfitResultViewExample" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    <if test="distinct">
      distinct
    </if>
    <include refid="Base_Column_List" />
    from `view_daily_profit_result`
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null">
      order by ${orderByClause}
    </if>
  </select>
  <select id="countByExample" parameterType="com.icpay.payment.db.dao.mybatis.model.DailyProfitResultViewExample" resultType="java.lang.Long">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select count(*) from `view_daily_profit_result`
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </select>
  <select id="countByHuanbiPpayFpay" parameterType="com.icpay.payment.db.dao.mybatis.model.modelExt.DailyProfitResultHuanbi" resultType="java.lang.Long">
	SELECT count(*)
	FROM
	(SELECT a.mchnt_cn_nm_prefix AS mchnt_cn_nm, IFNULL(SUM(a.txn_amt_sum_tx), 0) AS mchnt_txn_amt_sum
		, IFNULL(SUM(a.agent_profit), 0) AS mchnt_agent_profit
		, IFNULL(SUM(b.txn_amt_sum_ct), 0) AS mchnt_ct_txn_amt_sum
		, IFNULL(a.txn_amt_sum_tx / b.txn_amt_sum_ct, 0) AS mchnt_huanbi
	FROM (
		SELECT t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
			, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='mchntCnNm != null'>
			AND mchnt_cn_nm LIKE #{mchntCnNm}
			</if>
		GROUP BY mchnt_cn_nm_prefix
	) a
		LEFT JOIN (
			SELECT t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
				, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='mchntCnNm != null'>
				AND mchnt_cn_nm LIKE #{mchntCnNm}
				</if>
			GROUP BY mchnt_cn_nm_prefix
		) b
		ON a.mchnt_cn_nm_prefix = b.mchnt_cn_nm_prefix
	GROUP BY mchnt_cn_nm
	UNION
	SELECT b.mchnt_cn_nm_prefix AS mchnt_cn_nm, IFNULL(SUM(a.txn_amt_sum_tx), 0) AS mchnt_txn_amt_sum
		, IFNULL(SUM(a.agent_profit), 0) AS mchnt_agent_profit
		, IFNULL(SUM(b.txn_amt_sum_ct), 0) AS mchnt_ct_txn_amt_sum
		, IFNULL(a.txn_amt_sum_tx / b.txn_amt_sum_ct, 0) AS mchnt_huanbi
	FROM (
		SELECT t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
			, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='mchntCnNm != null'>
			AND mchnt_cn_nm LIKE #{mchntCnNm}
			</if>
		GROUP BY mchnt_cn_nm_prefix
	) a
		RIGHT JOIN (
			SELECT t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
				, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='mchntCnNm != null'>
				AND mchnt_cn_nm LIKE #{mchntCnNm}
				</if>
			GROUP BY mchnt_cn_nm_prefix
		) b
		ON a.mchnt_cn_nm_prefix = b.mchnt_cn_nm_prefix
	GROUP BY mchnt_cn_nm) c
  </select>
  <select id="countByHuanbiLpayVpay" parameterType="com.icpay.payment.db.dao.mybatis.model.modelExt.DailyProfitResultHuanbi" resultType="java.lang.Long">
  	SELECT count(*)
	FROM
	(SELECT a.mchnt_cn_nm, IFNULL(SUM(a.txn_amt_sum_tx), 0) AS mchnt_txn_amt_sum
		, IFNULL(SUM(a.agent_profit), 0) AS mchnt_agent_profit
		, IFNULL(SUM(b.txn_amt_sum_ct), 0) AS mchnt_ct_txn_amt_sum
		, IFNULL(a.txn_amt_sum_tx / b.txn_amt_sum_ct, 0) AS mchnt_huanbi
	FROM (
		SELECT t.settle_date AS settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
			, mi.mchnt_cn_nm AS mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='mchntCnNm != null'>
			AND mchnt_cn_nm LIKE #{mchntCnNm}
			</if>
		GROUP BY mchnt_cn_nm
	) a
		LEFT JOIN (
			SELECT t.settle_date AS settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
				, mi.mchnt_cn_nm AS mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='mchntCnNm != null'>
				AND mchnt_cn_nm LIKE #{mchntCnNm}
				</if>
			GROUP BY mchnt_cn_nm
		) b
		ON a.mchnt_cn_nm = b.mchnt_cn_nm
	GROUP BY mchnt_cn_nm
	UNION
	SELECT b.mchnt_cn_nm, IFNULL(SUM(a.txn_amt_sum_tx), 0) AS mchnt_txn_amt_sum
		, IFNULL(SUM(a.agent_profit), 0) AS mchnt_agent_profit
		, IFNULL(SUM(b.txn_amt_sum_ct), 0) AS mchnt_ct_txn_amt_sum
		, IFNULL(a.txn_amt_sum_tx / b.txn_amt_sum_ct, 0) AS mchnt_huanbi
	FROM (
		SELECT t.settle_date AS settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
			, mi.mchnt_cn_nm AS mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='mchntCnNm != null'>
			AND mchnt_cn_nm LIKE #{mchntCnNm}
			</if>
		GROUP BY mchnt_cn_nm
	) a
		RIGHT JOIN (
			SELECT t.settle_date AS settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
				, mi.mchnt_cn_nm AS mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='mchntCnNm != null'>
				AND mchnt_cn_nm LIKE #{mchntCnNm}
				</if>
			GROUP BY mchnt_cn_nm
		) b
		ON a.mchnt_cn_nm = b.mchnt_cn_nm
	GROUP BY mchnt_cn_nm) c
  </select>
  <select id="countByManagerPpayFpay" parameterType="com.icpay.payment.db.dao.mybatis.model.modelExt.DailyProfitResultManager" resultType="java.lang.Long">
	SELECT count(*)
	FROM
	(SELECT c.int_trans_cd, c.mchnt_cn_nm, IFNULL(c.mchnt_txn_amt_sum, 0) AS mchnt_txn_amt_sum
		, IFNULL(c.mchnt_agent_profit, 0) AS mchnt_agent_profit
		, IFNULL(c.mchnt_ct_txn_amt_sum, 0) AS mchnt_ct_txn_amt_sum
		, IFNULL(c.mchnt_huanbi, 0) AS mchnt_huanbi
		, IFNULL(d.mchnt_txn_amt_sum, 0) AS trans_txn_amt_sum
		, IFNULL(d.mchnt_agent_profit, 0) AS trans_agent_profit
		, IFNULL(d.mchnt_ct_txn_amt_sum, 0) AS trans_ct_txn_amt_sum
		, IFNULL(d.mchnt_huanbi, 0) AS trans_huanbi
	FROM (
	SELECT a.int_trans_cd, a.mchnt_cn_nm_prefix AS mchnt_cn_nm 
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.int_trans_cd, t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
			, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='intTransCd != null'>
			AND int_trans_cd = #{intTransCd}
			</if>
		GROUP BY int_trans_cd, mchnt_cn_nm_prefix
	) a
		LEFT JOIN (
			SELECT t.int_trans_cd, t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
				, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='intTransCd != null'>
				AND int_trans_cd = #{intTransCd}
				</if>
			GROUP BY int_trans_cd, mchnt_cn_nm_prefix
		) b
		ON a.mchnt_cn_nm_prefix = b.mchnt_cn_nm_prefix
		AND a.int_trans_cd = b.int_trans_cd
	GROUP BY mchnt_cn_nm, int_trans_cd) c
	LEFT join (
	SELECT a.int_trans_cd
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.int_trans_cd, t.settle_date, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='intTransCd != null'>
			AND int_trans_cd = #{intTransCd}
			</if>
		GROUP BY int_trans_cd
	) a
		LEFT JOIN (
			SELECT t.int_trans_cd, t.settle_date, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='intTransCd != null'>
				AND int_trans_cd = #{intTransCd}
				</if>
			GROUP BY int_trans_cd
		) b
		ON a.int_trans_cd = b.int_trans_cd
	GROUP BY int_trans_cd) d
		ON c.int_trans_cd = d.int_trans_cd
	GROUP BY mchnt_cn_nm, int_trans_cd
	UNION
	SELECT d.int_trans_cd, c.mchnt_cn_nm, IFNULL(c.mchnt_txn_amt_sum, 0) AS mchnt_txn_amt_sum
		, IFNULL(c.mchnt_agent_profit, 0) AS mchnt_agent_profit
		, IFNULL(c.mchnt_ct_txn_amt_sum, 0) AS mchnt_ct_txn_amt_sum
		, IFNULL(c.mchnt_huanbi, 0) AS mchnt_huanbi
		, IFNULL(d.mchnt_txn_amt_sum, 0) AS trans_txn_amt_sum
		, IFNULL(d.mchnt_agent_profit, 0) AS trans_agent_profit
		, IFNULL(d.mchnt_ct_txn_amt_sum, 0) AS trans_ct_txn_amt_sum
		, IFNULL(d.mchnt_huanbi, 0) AS trans_huanbi
	FROM (
	SELECT b.int_trans_cd, b.mchnt_cn_nm_prefix AS mchnt_cn_nm 
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.int_trans_cd, t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
			, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='intTransCd != null'>
			AND int_trans_cd = #{intTransCd}
			</if>
		GROUP BY int_trans_cd, mchnt_cn_nm_prefix
	) a
		RIGHT JOIN (
			SELECT t.int_trans_cd, t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
				, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='intTransCd != null'>
				AND int_trans_cd = #{intTransCd}
				</if>
			GROUP BY int_trans_cd, mchnt_cn_nm_prefix
		) b
		ON a.mchnt_cn_nm_prefix = b.mchnt_cn_nm_prefix
		AND a.int_trans_cd = b.int_trans_cd
	GROUP BY mchnt_cn_nm, int_trans_cd) c
	LEFT join (
	SELECT b.int_trans_cd
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.int_trans_cd, t.settle_date, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='intTransCd != null'>
			AND int_trans_cd = #{intTransCd}
			</if>
		GROUP BY int_trans_cd
	) a
		RIGHT JOIN (
			SELECT t.int_trans_cd, t.settle_date, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='intTransCd != null'>
				AND int_trans_cd = #{intTransCd}
				</if>
			GROUP BY int_trans_cd
		) b
		ON a.int_trans_cd = b.int_trans_cd
	GROUP BY int_trans_cd) d
		ON c.int_trans_cd = d.int_trans_cd
	GROUP BY mchnt_cn_nm, int_trans_cd) z
  </select>
  <select id="countByManagerLpayVpay" parameterType="com.icpay.payment.db.dao.mybatis.model.modelExt.DailyProfitResultManager" resultType="java.lang.Long">
	SELECT count(*)
	FROM
	(SELECT c.int_trans_cd, c.mchnt_cn_nm, IFNULL(c.mchnt_txn_amt_sum, 0) AS mchnt_txn_amt_sum
		, IFNULL(c.mchnt_agent_profit, 0) AS mchnt_agent_profit
		, IFNULL(c.mchnt_ct_txn_amt_sum, 0) AS mchnt_ct_txn_amt_sum
		, IFNULL(c.mchnt_huanbi, 0) AS mchnt_huanbi
		, IFNULL(d.mchnt_txn_amt_sum, 0) AS trans_txn_amt_sum
		, IFNULL(d.mchnt_agent_profit, 0) AS trans_agent_profit
		, IFNULL(d.mchnt_ct_txn_amt_sum, 0) AS trans_ct_txn_amt_sum
		, IFNULL(d.mchnt_huanbi, 0) AS trans_huanbi
	FROM (
	SELECT a.int_trans_cd, a.mchnt_cn_nm 
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.int_trans_cd, t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
			, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='intTransCd != null'>
			AND int_trans_cd = #{intTransCd}
			</if>
		GROUP BY int_trans_cd, mchnt_cn_nm
	) a
		LEFT JOIN (
			SELECT t.int_trans_cd, t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
				, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='intTransCd != null'>
				AND int_trans_cd = #{intTransCd}
				</if>
			GROUP BY int_trans_cd, mchnt_cn_nm
		) b
		ON a.mchnt_cn_nm = b.mchnt_cn_nm
		AND a.int_trans_cd = b.int_trans_cd
	GROUP BY mchnt_cn_nm, int_trans_cd) c
	LEFT join (
	SELECT a.int_trans_cd
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.int_trans_cd, t.settle_date, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='intTransCd != null'>
			AND int_trans_cd = #{intTransCd}
			</if>
		GROUP BY int_trans_cd
	) a
		LEFT JOIN (
			SELECT t.int_trans_cd, t.settle_date, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='intTransCd != null'>
				AND int_trans_cd = #{intTransCd}
				</if>
			GROUP BY int_trans_cd
		) b
		ON a.int_trans_cd = b.int_trans_cd
	GROUP BY int_trans_cd) d
		ON c.int_trans_cd = d.int_trans_cd
	GROUP BY mchnt_cn_nm, int_trans_cd
	UNION
	SELECT d.int_trans_cd, c.mchnt_cn_nm, IFNULL(c.mchnt_txn_amt_sum, 0) AS mchnt_txn_amt_sum
		, IFNULL(c.mchnt_agent_profit, 0) AS mchnt_agent_profit
		, IFNULL(c.mchnt_ct_txn_amt_sum, 0) AS mchnt_ct_txn_amt_sum
		, IFNULL(c.mchnt_huanbi, 0) AS mchnt_huanbi
		, IFNULL(d.mchnt_txn_amt_sum, 0) AS trans_txn_amt_sum
		, IFNULL(d.mchnt_agent_profit, 0) AS trans_agent_profit
		, IFNULL(d.mchnt_ct_txn_amt_sum, 0) AS trans_ct_txn_amt_sum
		, IFNULL(d.mchnt_huanbi, 0) AS trans_huanbi
	FROM (
	SELECT b.int_trans_cd, b.mchnt_cn_nm 
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.int_trans_cd, t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
			, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='intTransCd != null'>
			AND int_trans_cd = #{intTransCd}
			</if>
		GROUP BY int_trans_cd, mchnt_cn_nm
	) a
		RIGHT JOIN (
			SELECT t.int_trans_cd, t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
				, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='intTransCd != null'>
				AND int_trans_cd = #{intTransCd}
				</if>
			GROUP BY int_trans_cd, mchnt_cn_nm
		) b
		ON a.mchnt_cn_nm = b.mchnt_cn_nm
		AND a.int_trans_cd = b.int_trans_cd
	GROUP BY mchnt_cn_nm, int_trans_cd) c
	LEFT join (
	SELECT b.int_trans_cd
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.int_trans_cd, t.settle_date, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='intTransCd != null'>
			AND int_trans_cd = #{intTransCd}
			</if>
		GROUP BY int_trans_cd
	) a
		RIGHT JOIN (
			SELECT t.int_trans_cd, t.settle_date, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='intTransCd != null'>
				AND int_trans_cd = #{intTransCd}
				</if>
			GROUP BY int_trans_cd
		) b
		ON a.int_trans_cd = b.int_trans_cd
	GROUP BY int_trans_cd) d
		ON c.int_trans_cd = d.int_trans_cd
	GROUP BY mchnt_cn_nm, int_trans_cd) z
  </select>
  <select id="countByEmployeePpayFpay" parameterType="com.icpay.payment.db.dao.mybatis.model.modelExt.DailyProfitResultEmployee" resultType="java.lang.Long">
	SELECT count(*)
	FROM
	(SELECT c.int_trans_cd, c.mchnt_cn_nm, IFNULL(c.mchnt_txn_amt_sum, 0) AS mchnt_txn_amt_sum
		, IFNULL(c.mchnt_ct_txn_amt_sum, 0) AS mchnt_ct_txn_amt_sum
		, IFNULL(c.mchnt_huanbi, 0) AS mchnt_huanbi
		, IFNULL(d.mchnt_txn_amt_sum, 0) AS trans_txn_amt_sum
		, IFNULL(d.mchnt_ct_txn_amt_sum, 0) AS trans_ct_txn_amt_sum
		, IFNULL(d.mchnt_huanbi, 0) AS trans_huanbi
	FROM (
	SELECT a.int_trans_cd, a.mchnt_cn_nm_prefix AS mchnt_cn_nm 
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.int_trans_cd, t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
			, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='intTransCd != null'>
			AND int_trans_cd = #{intTransCd}
			</if>
		GROUP BY int_trans_cd, mchnt_cn_nm_prefix
	) a
		LEFT JOIN (
			SELECT t.int_trans_cd, t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
				, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='intTransCd != null'>
				AND int_trans_cd = #{intTransCd}
				</if>
			GROUP BY int_trans_cd, mchnt_cn_nm_prefix
		) b
		ON a.mchnt_cn_nm_prefix = b.mchnt_cn_nm_prefix
		AND a.int_trans_cd = b.int_trans_cd
	GROUP BY mchnt_cn_nm, int_trans_cd) c
	LEFT join (
	SELECT a.int_trans_cd
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.int_trans_cd, t.settle_date, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='intTransCd != null'>
			AND int_trans_cd = #{intTransCd}
			</if>
		GROUP BY int_trans_cd
	) a
		LEFT JOIN (
			SELECT t.int_trans_cd, t.settle_date, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='intTransCd != null'>
				AND int_trans_cd = #{intTransCd}
				</if>
			GROUP BY int_trans_cd
		) b
		ON a.int_trans_cd = b.int_trans_cd
	GROUP BY int_trans_cd) d
		ON c.int_trans_cd = d.int_trans_cd
	GROUP BY mchnt_cn_nm, int_trans_cd
	UNION
	SELECT d.int_trans_cd, c.mchnt_cn_nm, IFNULL(c.mchnt_txn_amt_sum, 0) AS mchnt_txn_amt_sum
		, IFNULL(c.mchnt_ct_txn_amt_sum, 0) AS mchnt_ct_txn_amt_sum
		, IFNULL(c.mchnt_huanbi, 0) AS mchnt_huanbi
		, IFNULL(d.mchnt_txn_amt_sum, 0) AS trans_txn_amt_sum
		, IFNULL(d.mchnt_ct_txn_amt_sum, 0) AS trans_ct_txn_amt_sum
		, IFNULL(d.mchnt_huanbi, 0) AS trans_huanbi
	FROM (
	SELECT b.int_trans_cd, b.mchnt_cn_nm_prefix AS mchnt_cn_nm 
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.int_trans_cd, t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
			, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='intTransCd != null'>
			AND int_trans_cd = #{intTransCd}
			</if>
		GROUP BY int_trans_cd, mchnt_cn_nm_prefix
	) a
		RIGHT JOIN (
			SELECT t.int_trans_cd, t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
				, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='intTransCd != null'>
				AND int_trans_cd = #{intTransCd}
				</if>
			GROUP BY int_trans_cd, mchnt_cn_nm_prefix
		) b
		ON a.mchnt_cn_nm_prefix = b.mchnt_cn_nm_prefix
		AND a.int_trans_cd = b.int_trans_cd
	GROUP BY mchnt_cn_nm, int_trans_cd) c
	LEFT join (
	SELECT b.int_trans_cd
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.int_trans_cd, t.settle_date, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='intTransCd != null'>
			AND int_trans_cd = #{intTransCd}
			</if>
		GROUP BY int_trans_cd
	) a
		RIGHT JOIN (
			SELECT t.int_trans_cd, t.settle_date, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='intTransCd != null'>
				AND int_trans_cd = #{intTransCd}
				</if>
			GROUP BY int_trans_cd
		) b
		ON a.int_trans_cd = b.int_trans_cd
	GROUP BY int_trans_cd) d
		ON c.int_trans_cd = d.int_trans_cd
	GROUP BY mchnt_cn_nm, int_trans_cd) z
  </select>
  <select id="countByEmployeeLpayVpay" parameterType="com.icpay.payment.db.dao.mybatis.model.modelExt.DailyProfitResultEmployee" resultType="java.lang.Long">
	SELECT count(*)
	FROM
	(SELECT c.int_trans_cd, c.mchnt_cn_nm, IFNULL(c.mchnt_txn_amt_sum, 0) AS mchnt_txn_amt_sum
		, IFNULL(c.mchnt_ct_txn_amt_sum, 0) AS mchnt_ct_txn_amt_sum
		, IFNULL(c.mchnt_huanbi, 0) AS mchnt_huanbi
		, IFNULL(d.mchnt_txn_amt_sum, 0) AS trans_txn_amt_sum
		, IFNULL(d.mchnt_ct_txn_amt_sum, 0) AS trans_ct_txn_amt_sum
		, IFNULL(d.mchnt_huanbi, 0) AS trans_huanbi
	FROM (
	SELECT a.int_trans_cd, a.mchnt_cn_nm 
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.int_trans_cd, t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
			, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='intTransCd != null'>
			AND int_trans_cd = #{intTransCd}
			</if>
		GROUP BY int_trans_cd, mchnt_cn_nm
	) a
		LEFT JOIN (
			SELECT t.int_trans_cd, t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
				, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='intTransCd != null'>
				AND int_trans_cd = #{intTransCd}
				</if>
			GROUP BY int_trans_cd, mchnt_cn_nm
		) b
		ON a.mchnt_cn_nm = b.mchnt_cn_nm
		AND a.int_trans_cd = b.int_trans_cd
	GROUP BY mchnt_cn_nm, int_trans_cd) c
	LEFT join (
	SELECT a.int_trans_cd
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.int_trans_cd, t.settle_date, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='intTransCd != null'>
			AND int_trans_cd = #{intTransCd}
			</if>
		GROUP BY int_trans_cd
	) a
		LEFT JOIN (
			SELECT t.int_trans_cd, t.settle_date, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='intTransCd != null'>
				AND int_trans_cd = #{intTransCd}
				</if>
			GROUP BY int_trans_cd
		) b
		ON a.int_trans_cd = b.int_trans_cd
	GROUP BY int_trans_cd) d
		ON c.int_trans_cd = d.int_trans_cd
	GROUP BY mchnt_cn_nm, int_trans_cd
	UNION
	SELECT d.int_trans_cd, c.mchnt_cn_nm, IFNULL(c.mchnt_txn_amt_sum, 0) AS mchnt_txn_amt_sum
		, IFNULL(c.mchnt_ct_txn_amt_sum, 0) AS mchnt_ct_txn_amt_sum
		, IFNULL(c.mchnt_huanbi, 0) AS mchnt_huanbi
		, IFNULL(d.mchnt_txn_amt_sum, 0) AS trans_txn_amt_sum
		, IFNULL(d.mchnt_ct_txn_amt_sum, 0) AS trans_ct_txn_amt_sum
		, IFNULL(d.mchnt_huanbi, 0) AS trans_huanbi
	FROM (
	SELECT b.int_trans_cd, b.mchnt_cn_nm 
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.int_trans_cd, t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
			, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='intTransCd != null'>
			AND int_trans_cd = #{intTransCd}
			</if>
		GROUP BY int_trans_cd, mchnt_cn_nm
	) a
		RIGHT JOIN (
			SELECT t.int_trans_cd, t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
				, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='intTransCd != null'>
				AND int_trans_cd = #{intTransCd}
				</if>
			GROUP BY int_trans_cd, mchnt_cn_nm
		) b
		ON a.mchnt_cn_nm = b.mchnt_cn_nm
		AND a.int_trans_cd = b.int_trans_cd
	GROUP BY mchnt_cn_nm, int_trans_cd) c
	LEFT join (
	SELECT b.int_trans_cd
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.int_trans_cd, t.settle_date, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='intTransCd != null'>
			AND int_trans_cd = #{intTransCd}
			</if>
		GROUP BY int_trans_cd
	) a
		RIGHT JOIN (
			SELECT t.int_trans_cd, t.settle_date, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='intTransCd != null'>
				AND int_trans_cd = #{intTransCd}
				</if>
			GROUP BY int_trans_cd
		) b
		ON a.int_trans_cd = b.int_trans_cd
	GROUP BY int_trans_cd) d
		ON c.int_trans_cd = d.int_trans_cd
	GROUP BY mchnt_cn_nm, int_trans_cd) z
  </select>
  <select id="countByChnlTrans" parameterType="com.icpay.payment.db.dao.mybatis.model.modelExt.DailyProfitResultChnlTrans" resultType="java.lang.Long">
  	SELECT count(*)
	FROM
	(SELECT c.chnl_id, c.int_trans_cd, IFNULL(c.mchnt_txn_amt_sum, 0) AS chnl_trans_txn_amt_sum
		, IFNULL(c.mchnt_agent_profit, 0) AS chnl_trans_agent_profit
		, IFNULL(c.mchnt_ct_txn_amt_sum, 0) AS chnl_trans_ct_txn_amt_sum
		, IFNULL(c.mchnt_huanbi, 0) AS chnl_trans_huanbi
		, IFNULL(d.mchnt_txn_amt_sum, 0) AS chnl_txn_amt_sum
		, IFNULL(d.mchnt_agent_profit, 0) AS chnl_agent_profit
		, IFNULL(d.mchnt_ct_txn_amt_sum, 0) AS chnl_ct_txn_amt_sum
		, IFNULL(d.mchnt_huanbi, 0) AS chnl_huanbi
	FROM (
	SELECT a.chnl_id, a.int_trans_cd
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.settle_date, t.chnl_id, t.int_trans_cd
		, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_chnl_info ci ON t.chnl_id = ci.chnl_id
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='chnlId != null'>
			AND t.chnl_id = #{chnlId}
			</if>
		GROUP BY t.chnl_id, t.int_trans_cd
	) a
		LEFT JOIN (
			SELECT t.settle_date, t.chnl_id, t.int_trans_cd
			, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_chnl_info ci ON t.chnl_id = ci.chnl_id
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='chnlId != null'>
				AND t.chnl_id = #{chnlId}
				</if>
			GROUP BY t.chnl_id, t.int_trans_cd
		) b
		ON a.chnl_id = b.chnl_id
		AND a.int_trans_cd = b.int_trans_cd
	GROUP BY chnl_id, int_trans_cd) c
	LEFT join (
	SELECT a.chnl_id
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.settle_date, t.chnl_id, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_chnl_info ci ON t.chnl_id = ci.chnl_id
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='chnlId != null'>
			AND t.chnl_id = #{chnlId}
			</if>
		GROUP BY chnl_id
	) a
		LEFT JOIN (
		SELECT t.settle_date, t.chnl_id, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_chnl_info ci ON t.chnl_id = ci.chnl_id
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
			<if test='chnlId != null'>
			AND t.chnl_id = #{chnlId}
			</if>
		GROUP BY chnl_id
		) b
		ON a.chnl_id = b.chnl_id
	GROUP BY chnl_id) d
		ON c.chnl_id = d.chnl_id
	GROUP BY chnl_id, int_trans_cd
	UNION
	SELECT d.chnl_id, c.int_trans_cd, IFNULL(c.mchnt_txn_amt_sum, 0) AS mchnt_txn_amt_sum
		, IFNULL(c.mchnt_agent_profit, 0) AS mchnt_agent_profit
		, IFNULL(c.mchnt_ct_txn_amt_sum, 0) AS mchnt_ct_txn_amt_sum
		, IFNULL(c.mchnt_huanbi, 0) AS mchnt_huanbi
		, IFNULL(d.mchnt_txn_amt_sum, 0) AS trans_txn_amt_sum
		, IFNULL(d.mchnt_agent_profit, 0) AS trans_agent_profit
		, IFNULL(d.mchnt_ct_txn_amt_sum, 0) AS trans_ct_txn_amt_sum
		, IFNULL(d.mchnt_huanbi, 0) AS trans_huanbi
	FROM (
	SELECT b.chnl_id, b.int_trans_cd
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.settle_date, t.chnl_id, t.int_trans_cd
		, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_chnl_info ci ON t.chnl_id = ci.chnl_id
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='chnlId != null'>
			AND t.chnl_id = #{chnlId}
			</if>
		GROUP BY t.chnl_id, t.int_trans_cd
	) a
		RIGHT JOIN (
			SELECT t.settle_date, t.chnl_id, t.int_trans_cd
			, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_chnl_info ci ON t.chnl_id = ci.chnl_id
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='chnlId != null'>
				AND t.chnl_id = #{chnlId}
				</if>
			GROUP BY t.chnl_id, t.int_trans_cd
		) b
		ON a.chnl_id = b.chnl_id
		AND a.int_trans_cd = b.int_trans_cd
	GROUP BY chnl_id, int_trans_cd) c
	LEFT join (
	SELECT b.chnl_id
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.settle_date, t.chnl_id, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_chnl_info ci ON t.chnl_id = ci.chnl_id
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='chnlId != null'>
			AND t.chnl_id = #{chnlId}
			</if>
		GROUP BY chnl_id
	) a
		RIGHT JOIN (
		SELECT t.settle_date, t.chnl_id, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_chnl_info ci ON t.chnl_id = ci.chnl_id
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
			<if test='chnlId != null'>
			AND t.chnl_id = #{chnlId}
			</if>
		GROUP BY chnl_id
		) b
		ON a.chnl_id = b.chnl_id
	GROUP BY chnl_id) d
		ON c.chnl_id = d.chnl_id
	GROUP BY chnl_id, int_trans_cd
	ORDER BY chnl_id, int_trans_cd, chnl_trans_txn_amt_sum DESC) z
  </select>
  <select id="selectByPage" parameterType="com.icpay.payment.db.dao.mybatis.model.DailyProfitResultViewExample" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    <if test="distinct">
      distinct
    </if>
    <include refid="Base_Column_List" />
    from `view_daily_profit_result`
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null">
      order by ${orderByClause}
    </if>
    <if test="startNum != null and pageSize !=null ">
      limit #{startNum} , #{pageSize}
    </if>
  </select>
  
  <select id="selectMchntProfit" parameterType="java.lang.String" resultType="com.icpay.payment.db.dao.mybatis.model.modelExt.MchntProfitToMerBean">
  	SELECT
		b.settle_date as settleDate,
		b.chnl_id as chnlId,
		b.chnl_desc as chnlDesc,
		b.mchnt_cn_nm as mchntCnNm,
		b.txn_amt_sum as txnAmtSum,
		b.agent_profit as agentProfit,
		CASE
			WHEN b.txn_amt_sum_percent IS NULL THEN
			'--' ELSE b.txn_amt_sum_percent 
		END as txnAmtSumPercent,
		FORMAT( c.chnl_txn_amt_sum / 100, 2 ) as chnlTxnAmtSum,
		c.chnl_agent_profit as chnlAgentProfit,
		CASE
			WHEN CONVERT ( c.chnl_txn_amt_sum / c.chnl_old_txn_amt_sum, DECIMAL ( 19, 2 ) ) IS NULL THEN
			'--' ELSE CONVERT ( c.chnl_txn_amt_sum / c.chnl_old_txn_amt_sum, DECIMAL ( 19, 2 ) ) 
		END as chnlTxnAmtSumPercent
		FROM
		(
			(
			SELECT
				t.settle_date,
				t.chnl_id,
				t.chnl_desc,
				t.mchnt_cd,
				t.mchnt_cn_nm,
				FORMAT( t.txn_amt_sum / 100, 2 ) txn_amt_sum,
				CONVERT (
					t.txn_amt_sum / (
					SELECT
						a.txn_amt_sum 
					FROM
						view_daily_profit_result a 
					WHERE
						a.settle_date = DATE_FORMAT( date_sub( #{settleDate}, INTERVAL 2 DAY ), '%Y%m%d' ) 
						AND a.chnl_id = t.chnl_id 
						AND a.mchnt_cn_nm = t.mchnt_cn_nm 
					),
					DECIMAL ( 10, 2 ) 
				) txn_amt_sum_percent,
				FORMAT(
					(
					SELECT
						a.txn_amt_sum 
					FROM
						view_daily_profit_result a 
					WHERE
						a.settle_date = DATE_FORMAT( date_sub( #{settleDate}, INTERVAL 2 DAY ), '%Y%m%d' ) 
						AND a.chnl_id = t.chnl_id 
						AND a.mchnt_cn_nm = t.mchnt_cn_nm 
					) / 100,
					2 
				) old_txn_amt_sum,
				FORMAT( t.agent_profit / 100, 2 ) agent_profit 
			FROM
				view_daily_profit_result t 
			WHERE
				t.settle_date = DATE_FORMAT( date_sub( #{settleDate} , INTERVAL 1 DAY ), '%Y%m%d' ) 
			) AS b
			JOIN (
			SELECT
				a.chnl_id,
				sum( a.txn_amt_sum ) chnl_txn_amt_sum,
				(
				SELECT
					sum( r.txn_amt_sum ) 
				FROM
					view_daily_profit_result r 
				WHERE
					r.settle_date = DATE_FORMAT( date_sub( #{settleDate}, INTERVAL 2 DAY ), '%Y%m%d' ) 
					AND a.chnl_id = r.chnl_id 
				) chnl_old_txn_amt_sum,
				FORMAT( sum( a.agent_profit ) / 100, 2 ) chnl_agent_profit 
			FROM
				view_daily_profit_result a 
			WHERE
				a.settle_date = DATE_FORMAT( date_sub(#{settleDate} , INTERVAL 1 DAY ), '%Y%m%d' ) 
			GROUP BY
				a.chnl_id 
			) AS c ON b.chnl_id = c.chnl_id 
		)
  </select>
  
  <select id="selectHuanbi" parameterType="com.icpay.payment.db.dao.mybatis.model.modelExt.MchntTransHuanbiBean" resultType= "com.icpay.payment.db.dao.mybatis.model.modelExt.MchntTransHuanbiBean" >
  	select a.ext_trans_dt settleDate, 
			mi.mchnt_cd mchntCd,
			mi.mchnt_cn_nm mchntCnNm,
			a.trans_at txnAmtSum
		from tbl_mchnt_info mi 
		left join (
		select
			t.ext_trans_dt,
			t.mchnt_cd,
			sum(t.trans_at) trans_at
		from
			tbl_trans_log${mon} t 
		where
			DATE_FORMAT(t.rec_crt_ts, '%Y%m%d') = #{settleDate}
			and t.txn_state ='10' 
			and t.int_trans_cd like '01%'
		group by
			DATE_FORMAT(t.rec_crt_ts, '%Y%m%d'),
			t.mchnt_cd ) as a 
			on mi.mchnt_cd = a.mchnt_cd 
		where mi.mchnt_st='1' 
			AND ( NOT ( ( `mi`.`mchnt_cd` REGEXP cast( '[A-Za-z]' AS CHAR charset BINARY ) ) ) ) 
  </select>
  
  <select id="selectWeek" resultType ="com.icpay.payment.db.dao.mybatis.model.modelExt.MchntProfitToWeekBean">
  	SELECT t.mchnt_cd mchntCd,
			t.mchnt_cn_nm mchntCnNm,
			CONVERT (t.txn_amt_sum, DECIMAL ( 19, 2 ) )  txnAmtSum,
			CONVERT (t.txn_amt_sum_old, DECIMAL ( 19, 2 ) )  txnAmtSumOld,
			t.txn_amt_sum_percent txnAmtSumPercent
		from view_week_profit_result t 
  </select>
  
  <select id="selectHuanbiPpayFpay" resultMap="HuanbiMap" >
	SELECT a.mchnt_cn_nm_prefix AS mchnt_cn_nm, IFNULL(SUM(a.txn_amt_sum_tx), 0) AS mchnt_txn_amt_sum
		, IFNULL(SUM(a.agent_profit), 0) AS mchnt_agent_profit
		, IFNULL(SUM(b.txn_amt_sum_ct), 0) AS mchnt_ct_txn_amt_sum
		, IFNULL(a.txn_amt_sum_tx / b.txn_amt_sum_ct, 0) AS mchnt_huanbi
	FROM (
		SELECT t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
			, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='mchntCnNm != null'>
			AND mchnt_cn_nm LIKE #{mchntCnNm}
			</if>
		GROUP BY mchnt_cn_nm_prefix
	) a
		LEFT JOIN (
			SELECT t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
				, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='mchntCnNm != null'>
				AND mchnt_cn_nm LIKE #{mchntCnNm}
				</if>
			GROUP BY mchnt_cn_nm_prefix
		) b
		ON a.mchnt_cn_nm_prefix = b.mchnt_cn_nm_prefix
	GROUP BY mchnt_cn_nm
	UNION
	SELECT b.mchnt_cn_nm_prefix AS mchnt_cn_nm, IFNULL(SUM(a.txn_amt_sum_tx), 0) AS mchnt_txn_amt_sum
		, IFNULL(SUM(a.agent_profit), 0) AS mchnt_agent_profit
		, IFNULL(SUM(b.txn_amt_sum_ct), 0) AS mchnt_ct_txn_amt_sum
		, IFNULL(a.txn_amt_sum_tx / b.txn_amt_sum_ct, 0) AS mchnt_huanbi
	FROM (
		SELECT t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
			, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='mchntCnNm != null'>
			AND mchnt_cn_nm LIKE #{mchntCnNm}
			</if>
		GROUP BY mchnt_cn_nm_prefix
	) a
		RIGHT JOIN (
			SELECT t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
				, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='mchntCnNm != null'>
				AND mchnt_cn_nm LIKE #{mchntCnNm}
				</if>
			GROUP BY mchnt_cn_nm_prefix
		) b
		ON a.mchnt_cn_nm_prefix = b.mchnt_cn_nm_prefix
	GROUP BY mchnt_cn_nm
	ORDER BY mchnt_txn_amt_sum DESC, mchnt_ct_txn_amt_sum DESC
  </select>
  
  <select id="selectHuanbiLpayVpay" resultMap="HuanbiMap" >
  	SELECT a.mchnt_cn_nm, IFNULL(SUM(a.txn_amt_sum_tx), 0) AS mchnt_txn_amt_sum
		, IFNULL(SUM(a.agent_profit), 0) AS mchnt_agent_profit
		, IFNULL(SUM(b.txn_amt_sum_ct), 0) AS mchnt_ct_txn_amt_sum
		, IFNULL(a.txn_amt_sum_tx / b.txn_amt_sum_ct, 0) AS mchnt_huanbi
	FROM (
		SELECT t.settle_date AS settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
			, mi.mchnt_cn_nm AS mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='mchntCnNm != null'>
			AND mchnt_cn_nm LIKE #{mchntCnNm}
			</if>
		GROUP BY mchnt_cn_nm
	) a
		LEFT JOIN (
			SELECT t.settle_date AS settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
				, mi.mchnt_cn_nm AS mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='mchntCnNm != null'>
				AND mchnt_cn_nm LIKE #{mchntCnNm}
				</if>
			GROUP BY mchnt_cn_nm
		) b
		ON a.mchnt_cn_nm = b.mchnt_cn_nm
	GROUP BY mchnt_cn_nm
	UNION
	SELECT b.mchnt_cn_nm, IFNULL(SUM(a.txn_amt_sum_tx), 0) AS mchnt_txn_amt_sum
		, IFNULL(SUM(a.agent_profit), 0) AS mchnt_agent_profit
		, IFNULL(SUM(b.txn_amt_sum_ct), 0) AS mchnt_ct_txn_amt_sum
		, IFNULL(a.txn_amt_sum_tx / b.txn_amt_sum_ct, 0) AS mchnt_huanbi
	FROM (
		SELECT t.settle_date AS settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
			, mi.mchnt_cn_nm AS mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='mchntCnNm != null'>
			AND mchnt_cn_nm LIKE #{mchntCnNm}
			</if>
		GROUP BY mchnt_cn_nm
	) a
		RIGHT JOIN (
			SELECT t.settle_date AS settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
				, mi.mchnt_cn_nm AS mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='mchntCnNm != null'>
				AND mchnt_cn_nm LIKE #{mchntCnNm}
				</if>
			GROUP BY mchnt_cn_nm
		) b
		ON a.mchnt_cn_nm = b.mchnt_cn_nm
	GROUP BY mchnt_cn_nm
	ORDER BY mchnt_txn_amt_sum DESC, mchnt_ct_txn_amt_sum DESC
  </select>
  
  <resultMap id="HuanbiMap" type="com.icpay.payment.db.dao.mybatis.model.modelExt.DailyProfitResultHuanbi">
    <constructor>
      <arg column="mchnt_cn_nm" javaType="java.lang.String" jdbcType="VARCHAR"/>
      <arg column="mchnt_txn_amt_sum" javaType="java.math.BigDecimal" jdbcType="DECIMAL"/>
      <arg column="mchnt_agent_profit" javaType="java.math.BigDecimal" jdbcType="DECIMAL"/>
      <arg column="mchnt_ct_txn_amt_sum" javaType="java.math.BigDecimal" jdbcType="DECIMAL"/>
      <arg column="mchnt_huanbi" javaType="java.math.BigDecimal" jdbcType="DECIMAL"/>
    </constructor>
  </resultMap>
  
  <select id="selectManagerPpayFpay" resultMap="ManagerMap" >
	SELECT c.int_trans_cd, c.mchnt_cn_nm, IFNULL(c.mchnt_txn_amt_sum, 0) AS mchnt_txn_amt_sum
		, IFNULL(c.mchnt_agent_profit, 0) AS mchnt_agent_profit
		, IFNULL(c.mchnt_ct_txn_amt_sum, 0) AS mchnt_ct_txn_amt_sum
		, IFNULL(c.mchnt_huanbi, 0) AS mchnt_huanbi
		, IFNULL(d.mchnt_txn_amt_sum, 0) AS trans_txn_amt_sum
		, IFNULL(d.mchnt_agent_profit, 0) AS trans_agent_profit
		, IFNULL(d.mchnt_ct_txn_amt_sum, 0) AS trans_ct_txn_amt_sum
		, IFNULL(d.mchnt_huanbi, 0) AS trans_huanbi
	FROM (
	SELECT a.int_trans_cd, a.mchnt_cn_nm_prefix AS mchnt_cn_nm 
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.int_trans_cd, t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
			, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='intTransCd != null'>
			AND int_trans_cd = #{intTransCd}
			</if>
		GROUP BY int_trans_cd, mchnt_cn_nm_prefix
	) a
		LEFT JOIN (
			SELECT t.int_trans_cd, t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
				, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='intTransCd != null'>
				AND int_trans_cd = #{intTransCd}
				</if>
			GROUP BY int_trans_cd, mchnt_cn_nm_prefix
		) b
		ON a.mchnt_cn_nm_prefix = b.mchnt_cn_nm_prefix
		AND a.int_trans_cd = b.int_trans_cd
	GROUP BY mchnt_cn_nm, int_trans_cd) c
	LEFT join (
	SELECT a.int_trans_cd
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.int_trans_cd, t.settle_date, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='intTransCd != null'>
			AND int_trans_cd = #{intTransCd}
			</if>
		GROUP BY int_trans_cd
	) a
		LEFT JOIN (
			SELECT t.int_trans_cd, t.settle_date, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='intTransCd != null'>
				AND int_trans_cd = #{intTransCd}
				</if>
			GROUP BY int_trans_cd
		) b
		ON a.int_trans_cd = b.int_trans_cd
	GROUP BY int_trans_cd) d
		ON c.int_trans_cd = d.int_trans_cd
	GROUP BY mchnt_cn_nm, int_trans_cd
	UNION
	SELECT d.int_trans_cd, c.mchnt_cn_nm, IFNULL(c.mchnt_txn_amt_sum, 0) AS mchnt_txn_amt_sum
		, IFNULL(c.mchnt_agent_profit, 0) AS mchnt_agent_profit
		, IFNULL(c.mchnt_ct_txn_amt_sum, 0) AS mchnt_ct_txn_amt_sum
		, IFNULL(c.mchnt_huanbi, 0) AS mchnt_huanbi
		, IFNULL(d.mchnt_txn_amt_sum, 0) AS trans_txn_amt_sum
		, IFNULL(d.mchnt_agent_profit, 0) AS trans_agent_profit
		, IFNULL(d.mchnt_ct_txn_amt_sum, 0) AS trans_ct_txn_amt_sum
		, IFNULL(d.mchnt_huanbi, 0) AS trans_huanbi
	FROM (
	SELECT b.int_trans_cd, b.mchnt_cn_nm_prefix AS mchnt_cn_nm 
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.int_trans_cd, t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
			, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='intTransCd != null'>
			AND int_trans_cd = #{intTransCd}
			</if>
		GROUP BY int_trans_cd, mchnt_cn_nm_prefix
	) a
		RIGHT JOIN (
			SELECT t.int_trans_cd, t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
				, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='intTransCd != null'>
				AND int_trans_cd = #{intTransCd}
				</if>
			GROUP BY int_trans_cd, mchnt_cn_nm_prefix
		) b
		ON a.mchnt_cn_nm_prefix = b.mchnt_cn_nm_prefix
		AND a.int_trans_cd = b.int_trans_cd
	GROUP BY mchnt_cn_nm, int_trans_cd) c
	LEFT join (
	SELECT b.int_trans_cd
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.int_trans_cd, t.settle_date, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='intTransCd != null'>
			AND int_trans_cd = #{intTransCd}
			</if>
		GROUP BY int_trans_cd
	) a
		RIGHT JOIN (
			SELECT t.int_trans_cd, t.settle_date, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='intTransCd != null'>
				AND int_trans_cd = #{intTransCd}
				</if>
			GROUP BY int_trans_cd
		) b
		ON a.int_trans_cd = b.int_trans_cd
	GROUP BY int_trans_cd) d
		ON c.int_trans_cd = d.int_trans_cd
	GROUP BY mchnt_cn_nm, int_trans_cd 
	ORDER BY int_trans_cd, mchnt_txn_amt_sum DESC
  </select>
  
  <select id="selectManagerLpayVpay" resultMap="ManagerMap" >
  	SELECT c.int_trans_cd, c.mchnt_cn_nm, IFNULL(c.mchnt_txn_amt_sum, 0) AS mchnt_txn_amt_sum
		, IFNULL(c.mchnt_agent_profit, 0) AS mchnt_agent_profit
		, IFNULL(c.mchnt_ct_txn_amt_sum, 0) AS mchnt_ct_txn_amt_sum
		, IFNULL(c.mchnt_huanbi, 0) AS mchnt_huanbi
		, IFNULL(d.mchnt_txn_amt_sum, 0) AS trans_txn_amt_sum
		, IFNULL(d.mchnt_agent_profit, 0) AS trans_agent_profit
		, IFNULL(d.mchnt_ct_txn_amt_sum, 0) AS trans_ct_txn_amt_sum
		, IFNULL(d.mchnt_huanbi, 0) AS trans_huanbi
	FROM (
	SELECT a.int_trans_cd, a.mchnt_cn_nm 
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.int_trans_cd, t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
			, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='intTransCd != null'>
			AND int_trans_cd = #{intTransCd}
			</if>
		GROUP BY int_trans_cd, mchnt_cn_nm
	) a
		LEFT JOIN (
			SELECT t.int_trans_cd, t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
				, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='intTransCd != null'>
				AND int_trans_cd = #{intTransCd}
				</if>
			GROUP BY int_trans_cd, mchnt_cn_nm
		) b
		ON a.mchnt_cn_nm = b.mchnt_cn_nm
		AND a.int_trans_cd = b.int_trans_cd
	GROUP BY mchnt_cn_nm, int_trans_cd) c
	LEFT join (
	SELECT a.int_trans_cd
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.int_trans_cd, t.settle_date, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='intTransCd != null'>
			AND int_trans_cd = #{intTransCd}
			</if>
		GROUP BY int_trans_cd
	) a
		LEFT JOIN (
			SELECT t.int_trans_cd, t.settle_date, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='intTransCd != null'>
				AND int_trans_cd = #{intTransCd}
				</if>
			GROUP BY int_trans_cd
		) b
		ON a.int_trans_cd = b.int_trans_cd
	GROUP BY int_trans_cd) d
		ON c.int_trans_cd = d.int_trans_cd
	GROUP BY mchnt_cn_nm, int_trans_cd
	UNION
	SELECT d.int_trans_cd, c.mchnt_cn_nm, IFNULL(c.mchnt_txn_amt_sum, 0) AS mchnt_txn_amt_sum
		, IFNULL(c.mchnt_agent_profit, 0) AS mchnt_agent_profit
		, IFNULL(c.mchnt_ct_txn_amt_sum, 0) AS mchnt_ct_txn_amt_sum
		, IFNULL(c.mchnt_huanbi, 0) AS mchnt_huanbi
		, IFNULL(d.mchnt_txn_amt_sum, 0) AS trans_txn_amt_sum
		, IFNULL(d.mchnt_agent_profit, 0) AS trans_agent_profit
		, IFNULL(d.mchnt_ct_txn_amt_sum, 0) AS trans_ct_txn_amt_sum
		, IFNULL(d.mchnt_huanbi, 0) AS trans_huanbi
	FROM (
	SELECT b.int_trans_cd, b.mchnt_cn_nm 
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.int_trans_cd, t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
			, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='intTransCd != null'>
			AND int_trans_cd = #{intTransCd}
			</if>
		GROUP BY int_trans_cd, mchnt_cn_nm
	) a
		RIGHT JOIN (
			SELECT t.int_trans_cd, t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
				, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='intTransCd != null'>
				AND int_trans_cd = #{intTransCd}
				</if>
			GROUP BY int_trans_cd, mchnt_cn_nm
		) b
		ON a.mchnt_cn_nm = b.mchnt_cn_nm
		AND a.int_trans_cd = b.int_trans_cd
	GROUP BY mchnt_cn_nm, int_trans_cd) c
	LEFT join (
	SELECT b.int_trans_cd
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.int_trans_cd, t.settle_date, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='intTransCd != null'>
			AND int_trans_cd = #{intTransCd}
			</if>
		GROUP BY int_trans_cd
	) a
		RIGHT JOIN (
			SELECT t.int_trans_cd, t.settle_date, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='intTransCd != null'>
				AND int_trans_cd = #{intTransCd}
				</if>
			GROUP BY int_trans_cd
		) b
		ON a.int_trans_cd = b.int_trans_cd
	GROUP BY int_trans_cd) d
		ON c.int_trans_cd = d.int_trans_cd
	GROUP BY mchnt_cn_nm, int_trans_cd 
	ORDER BY int_trans_cd, mchnt_txn_amt_sum DESC
  </select>
  
  <resultMap id="ManagerMap" type="com.icpay.payment.db.dao.mybatis.model.modelExt.DailyProfitResultManager">
    <constructor>
      <arg column="int_trans_cd" javaType="java.lang.String" jdbcType="VARCHAR"/>
      <arg column="mchnt_cn_nm" javaType="java.lang.String" jdbcType="VARCHAR"/>
      <arg column="mchnt_txn_amt_sum" javaType="java.math.BigDecimal" jdbcType="DECIMAL"/>
      <arg column="mchnt_agent_profit" javaType="java.math.BigDecimal" jdbcType="DECIMAL"/>
      <arg column="mchnt_ct_txn_amt_sum" javaType="java.math.BigDecimal" jdbcType="DECIMAL"/>
      <arg column="mchnt_huanbi" javaType="java.math.BigDecimal" jdbcType="DECIMAL"/>
      <arg column="trans_txn_amt_sum" javaType="java.math.BigDecimal" jdbcType="DECIMAL"/>
      <arg column="trans_agent_profit" javaType="java.math.BigDecimal" jdbcType="DECIMAL"/>
      <arg column="trans_ct_txn_amt_sum" javaType="java.math.BigDecimal" jdbcType="DECIMAL"/>
      <arg column="trans_huanbi" javaType="java.math.BigDecimal" jdbcType="DECIMAL"/>
    </constructor>
  </resultMap>
  
  <select id="selectEmployeePpayFpay" resultMap="EmployeeMap" >
	SELECT c.int_trans_cd, c.mchnt_cn_nm, IFNULL(c.mchnt_txn_amt_sum, 0) AS mchnt_txn_amt_sum
		, IFNULL(c.mchnt_ct_txn_amt_sum, 0) AS mchnt_ct_txn_amt_sum
		, IFNULL(c.mchnt_huanbi, 0) AS mchnt_huanbi
		, IFNULL(d.mchnt_txn_amt_sum, 0) AS trans_txn_amt_sum
		, IFNULL(d.mchnt_ct_txn_amt_sum, 0) AS trans_ct_txn_amt_sum
		, IFNULL(d.mchnt_huanbi, 0) AS trans_huanbi
	FROM (
	SELECT a.int_trans_cd, a.mchnt_cn_nm_prefix AS mchnt_cn_nm 
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.int_trans_cd, t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
			, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='intTransCd != null'>
			AND int_trans_cd = #{intTransCd}
			</if>
		GROUP BY int_trans_cd, mchnt_cn_nm_prefix
	) a
		LEFT JOIN (
			SELECT t.int_trans_cd, t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
				, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='intTransCd != null'>
				AND int_trans_cd = #{intTransCd}
				</if>
			GROUP BY int_trans_cd, mchnt_cn_nm_prefix
		) b
		ON a.mchnt_cn_nm_prefix = b.mchnt_cn_nm_prefix
		AND a.int_trans_cd = b.int_trans_cd
	GROUP BY mchnt_cn_nm, int_trans_cd) c
	LEFT join (
	SELECT a.int_trans_cd
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.int_trans_cd, t.settle_date, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='intTransCd != null'>
			AND int_trans_cd = #{intTransCd}
			</if>
		GROUP BY int_trans_cd
	) a
		LEFT JOIN (
			SELECT t.int_trans_cd, t.settle_date, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='intTransCd != null'>
				AND int_trans_cd = #{intTransCd}
				</if>
			GROUP BY int_trans_cd
		) b
		ON a.int_trans_cd = b.int_trans_cd
	GROUP BY int_trans_cd) d
		ON c.int_trans_cd = d.int_trans_cd
	GROUP BY mchnt_cn_nm, int_trans_cd
	UNION
	SELECT d.int_trans_cd, c.mchnt_cn_nm, IFNULL(c.mchnt_txn_amt_sum, 0) AS mchnt_txn_amt_sum
		, IFNULL(c.mchnt_ct_txn_amt_sum, 0) AS mchnt_ct_txn_amt_sum
		, IFNULL(c.mchnt_huanbi, 0) AS mchnt_huanbi
		, IFNULL(d.mchnt_txn_amt_sum, 0) AS trans_txn_amt_sum
		, IFNULL(d.mchnt_ct_txn_amt_sum, 0) AS trans_ct_txn_amt_sum
		, IFNULL(d.mchnt_huanbi, 0) AS trans_huanbi
	FROM (
	SELECT b.int_trans_cd, b.mchnt_cn_nm_prefix AS mchnt_cn_nm 
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.int_trans_cd, t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
			, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='intTransCd != null'>
			AND int_trans_cd = #{intTransCd}
			</if>
		GROUP BY int_trans_cd, mchnt_cn_nm_prefix
	) a
		RIGHT JOIN (
			SELECT t.int_trans_cd, t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
				, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='intTransCd != null'>
				AND int_trans_cd = #{intTransCd}
				</if>
			GROUP BY int_trans_cd, mchnt_cn_nm_prefix
		) b
		ON a.mchnt_cn_nm_prefix = b.mchnt_cn_nm_prefix
		AND a.int_trans_cd = b.int_trans_cd
	GROUP BY mchnt_cn_nm, int_trans_cd) c
	LEFT join (
	SELECT b.int_trans_cd
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.int_trans_cd, t.settle_date, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='intTransCd != null'>
			AND int_trans_cd = #{intTransCd}
			</if>
		GROUP BY int_trans_cd
	) a
		RIGHT JOIN (
			SELECT t.int_trans_cd, t.settle_date, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='intTransCd != null'>
				AND int_trans_cd = #{intTransCd}
				</if>
			GROUP BY int_trans_cd
		) b
		ON a.int_trans_cd = b.int_trans_cd
	GROUP BY int_trans_cd) d
		ON c.int_trans_cd = d.int_trans_cd
	GROUP BY mchnt_cn_nm, int_trans_cd 
	ORDER BY int_trans_cd, mchnt_txn_amt_sum DESC
  </select>
  
  <select id="selectEmployeeLpayVpay" resultMap="EmployeeMap" >
  	SELECT c.int_trans_cd, c.mchnt_cn_nm, IFNULL(c.mchnt_txn_amt_sum, 0) AS mchnt_txn_amt_sum
		, IFNULL(c.mchnt_ct_txn_amt_sum, 0) AS mchnt_ct_txn_amt_sum
		, IFNULL(c.mchnt_huanbi, 0) AS mchnt_huanbi
		, IFNULL(d.mchnt_txn_amt_sum, 0) AS trans_txn_amt_sum
		, IFNULL(d.mchnt_ct_txn_amt_sum, 0) AS trans_ct_txn_amt_sum
		, IFNULL(d.mchnt_huanbi, 0) AS trans_huanbi
	FROM (
	SELECT a.int_trans_cd, a.mchnt_cn_nm 
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.int_trans_cd, t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
			, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='intTransCd != null'>
			AND int_trans_cd = #{intTransCd}
			</if>
		GROUP BY int_trans_cd, mchnt_cn_nm
	) a
		LEFT JOIN (
			SELECT t.int_trans_cd, t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
				, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='intTransCd != null'>
				AND int_trans_cd = #{intTransCd}
				</if>
			GROUP BY int_trans_cd, mchnt_cn_nm
		) b
		ON a.mchnt_cn_nm = b.mchnt_cn_nm
		AND a.int_trans_cd = b.int_trans_cd
	GROUP BY mchnt_cn_nm, int_trans_cd) c
	LEFT join (
	SELECT a.int_trans_cd
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.int_trans_cd, t.settle_date, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='intTransCd != null'>
			AND int_trans_cd = #{intTransCd}
			</if>
		GROUP BY int_trans_cd
	) a
		LEFT JOIN (
			SELECT t.int_trans_cd, t.settle_date, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='intTransCd != null'>
				AND int_trans_cd = #{intTransCd}
				</if>
			GROUP BY int_trans_cd
		) b
		ON a.int_trans_cd = b.int_trans_cd
	GROUP BY int_trans_cd) d
		ON c.int_trans_cd = d.int_trans_cd
	GROUP BY mchnt_cn_nm, int_trans_cd
	UNION
	SELECT d.int_trans_cd, c.mchnt_cn_nm, IFNULL(c.mchnt_txn_amt_sum, 0) AS mchnt_txn_amt_sum
		, IFNULL(c.mchnt_ct_txn_amt_sum, 0) AS mchnt_ct_txn_amt_sum
		, IFNULL(c.mchnt_huanbi, 0) AS mchnt_huanbi
		, IFNULL(d.mchnt_txn_amt_sum, 0) AS trans_txn_amt_sum
		, IFNULL(d.mchnt_ct_txn_amt_sum, 0) AS trans_ct_txn_amt_sum
		, IFNULL(d.mchnt_huanbi, 0) AS trans_huanbi
	FROM (
	SELECT b.int_trans_cd, b.mchnt_cn_nm 
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.int_trans_cd, t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
			, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='intTransCd != null'>
			AND int_trans_cd = #{intTransCd}
			</if>
		GROUP BY int_trans_cd, mchnt_cn_nm
	) a
		RIGHT JOIN (
			SELECT t.int_trans_cd, t.settle_date, substring_index(mi.mchnt_cn_nm, '_', 1) AS mchnt_cn_nm_prefix
				, mi.mchnt_cn_nm, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='intTransCd != null'>
				AND int_trans_cd = #{intTransCd}
				</if>
			GROUP BY int_trans_cd, mchnt_cn_nm
		) b
		ON a.mchnt_cn_nm = b.mchnt_cn_nm
		AND a.int_trans_cd = b.int_trans_cd
	GROUP BY mchnt_cn_nm, int_trans_cd) c
	LEFT join (
	SELECT b.int_trans_cd
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.int_trans_cd, t.settle_date, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='intTransCd != null'>
			AND int_trans_cd = #{intTransCd}
			</if>
		GROUP BY int_trans_cd
	) a
		RIGHT JOIN (
			SELECT t.int_trans_cd, t.settle_date, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_mchnt_info mi ON t.mchnt_cd = mi.mchnt_cd
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='intTransCd != null'>
				AND int_trans_cd = #{intTransCd}
				</if>
			GROUP BY int_trans_cd
		) b
		ON a.int_trans_cd = b.int_trans_cd
	GROUP BY int_trans_cd) d
		ON c.int_trans_cd = d.int_trans_cd
	GROUP BY mchnt_cn_nm, int_trans_cd 
	ORDER BY int_trans_cd, mchnt_txn_amt_sum DESC
  </select>
  
  <resultMap id="EmployeeMap" type="com.icpay.payment.db.dao.mybatis.model.modelExt.DailyProfitResultEmployee">
    <constructor>
      <arg column="int_trans_cd" javaType="java.lang.String" jdbcType="VARCHAR"/>
      <arg column="mchnt_cn_nm" javaType="java.lang.String" jdbcType="VARCHAR"/>
      <arg column="mchnt_txn_amt_sum" javaType="java.math.BigDecimal" jdbcType="DECIMAL"/>
      <arg column="mchnt_ct_txn_amt_sum" javaType="java.math.BigDecimal" jdbcType="DECIMAL"/>
      <arg column="mchnt_huanbi" javaType="java.math.BigDecimal" jdbcType="DECIMAL"/>
      <arg column="trans_txn_amt_sum" javaType="java.math.BigDecimal" jdbcType="DECIMAL"/>
      <arg column="trans_ct_txn_amt_sum" javaType="java.math.BigDecimal" jdbcType="DECIMAL"/>
      <arg column="trans_huanbi" javaType="java.math.BigDecimal" jdbcType="DECIMAL"/>
    </constructor>
  </resultMap>
  
  <select id="selectChnlTrans" resultMap="ChnlTransMap" >
	SELECT c.chnl_id, c.int_trans_cd, IFNULL(c.mchnt_txn_amt_sum, 0) AS chnl_trans_txn_amt_sum
		, IFNULL(c.mchnt_agent_profit, 0) AS chnl_trans_agent_profit
		, IFNULL(c.mchnt_ct_txn_amt_sum, 0) AS chnl_trans_ct_txn_amt_sum
		, IFNULL(c.mchnt_huanbi, 0) AS chnl_trans_huanbi
		, IFNULL(d.mchnt_txn_amt_sum, 0) AS chnl_txn_amt_sum
		, IFNULL(d.mchnt_agent_profit, 0) AS chnl_agent_profit
		, IFNULL(d.mchnt_ct_txn_amt_sum, 0) AS chnl_ct_txn_amt_sum
		, IFNULL(d.mchnt_huanbi, 0) AS chnl_huanbi
	FROM (
	SELECT a.chnl_id, a.int_trans_cd
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.settle_date, t.chnl_id, t.int_trans_cd
		, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_chnl_info ci ON t.chnl_id = ci.chnl_id
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='chnlId != null'>
			AND t.chnl_id = #{chnlId}
			</if>
		GROUP BY t.chnl_id, t.int_trans_cd
	) a
		LEFT JOIN (
			SELECT t.settle_date, t.chnl_id, t.int_trans_cd
			, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_chnl_info ci ON t.chnl_id = ci.chnl_id
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='chnlId != null'>
				AND t.chnl_id = #{chnlId}
				</if>
			GROUP BY t.chnl_id, t.int_trans_cd
		) b
		ON a.chnl_id = b.chnl_id
		AND a.int_trans_cd = b.int_trans_cd
	GROUP BY chnl_id, int_trans_cd) c
	LEFT join (
	SELECT a.chnl_id
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.settle_date, t.chnl_id, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_chnl_info ci ON t.chnl_id = ci.chnl_id
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='chnlId != null'>
			AND t.chnl_id = #{chnlId}
			</if>
		GROUP BY chnl_id
	) a
		LEFT JOIN (
		SELECT t.settle_date, t.chnl_id, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_chnl_info ci ON t.chnl_id = ci.chnl_id
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
			<if test='chnlId != null'>
			AND t.chnl_id = #{chnlId}
			</if>
		GROUP BY chnl_id
		) b
		ON a.chnl_id = b.chnl_id
	GROUP BY chnl_id) d
		ON c.chnl_id = d.chnl_id
	GROUP BY chnl_id, int_trans_cd
	UNION
	SELECT d.chnl_id, c.int_trans_cd, IFNULL(c.mchnt_txn_amt_sum, 0) AS mchnt_txn_amt_sum
		, IFNULL(c.mchnt_agent_profit, 0) AS mchnt_agent_profit
		, IFNULL(c.mchnt_ct_txn_amt_sum, 0) AS mchnt_ct_txn_amt_sum
		, IFNULL(c.mchnt_huanbi, 0) AS mchnt_huanbi
		, IFNULL(d.mchnt_txn_amt_sum, 0) AS trans_txn_amt_sum
		, IFNULL(d.mchnt_agent_profit, 0) AS trans_agent_profit
		, IFNULL(d.mchnt_ct_txn_amt_sum, 0) AS trans_ct_txn_amt_sum
		, IFNULL(d.mchnt_huanbi, 0) AS trans_huanbi
	FROM (
	SELECT b.chnl_id, b.int_trans_cd
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.settle_date, t.chnl_id, t.int_trans_cd
		, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_chnl_info ci ON t.chnl_id = ci.chnl_id
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='chnlId != null'>
			AND t.chnl_id = #{chnlId}
			</if>
		GROUP BY t.chnl_id, t.int_trans_cd
	) a
		RIGHT JOIN (
			SELECT t.settle_date, t.chnl_id, t.int_trans_cd
			, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
			FROM icpay.tbl_agent_profit_settle_result t
				LEFT JOIN icpay.tbl_chnl_info ci ON t.chnl_id = ci.chnl_id
			WHERE (t.int_trans_cd != '5210'
					<if test='agentCd != null'>
					AND t.agent_cd = #{agentCd}
					</if>
					AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
				AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
				<if test='chnlId != null'>
				AND t.chnl_id = #{chnlId}
				</if>
			GROUP BY t.chnl_id, t.int_trans_cd
		) b
		ON a.chnl_id = b.chnl_id
		AND a.int_trans_cd = b.int_trans_cd
	GROUP BY chnl_id, int_trans_cd) c
	LEFT join (
	SELECT b.chnl_id
		, SUM(a.txn_amt_sum_tx) AS mchnt_txn_amt_sum
		, SUM(a.agent_profit) AS mchnt_agent_profit
		, SUM(b.txn_amt_sum_ct) AS mchnt_ct_txn_amt_sum
		, a.txn_amt_sum_tx / b.txn_amt_sum_ct AS mchnt_huanbi
	FROM (
		SELECT t.settle_date, t.chnl_id, SUM(t.txn_amt_sum) AS txn_amt_sum_tx, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_chnl_info ci ON t.chnl_id = ci.chnl_id
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{qryStartDate} AND #{qryEndDate}
			<if test='chnlId != null'>
			AND t.chnl_id = #{chnlId}
			</if>
		GROUP BY chnl_id
	) a
		RIGHT JOIN (
		SELECT t.settle_date, t.chnl_id, SUM(t.txn_amt_sum) AS txn_amt_sum_ct, SUM(t.agent_profit) AS agent_profit
		FROM icpay.tbl_agent_profit_settle_result t
			LEFT JOIN icpay.tbl_chnl_info ci ON t.chnl_id = ci.chnl_id
		WHERE (t.int_trans_cd != '5210'
				<if test='agentCd != null'>
				AND t.agent_cd = #{agentCd}
				</if>
				AND NOT t.mchnt_cd REGEXP CAST('[A-Z]' AS char CHARACTER SET binary))
			AND settle_date BETWEEN #{ctStartDate} AND #{ctEndDate}
			<if test='chnlId != null'>
			AND t.chnl_id = #{chnlId}
			</if>
		GROUP BY chnl_id
		) b
		ON a.chnl_id = b.chnl_id
	GROUP BY chnl_id) d
		ON c.chnl_id = d.chnl_id
	GROUP BY chnl_id, int_trans_cd
	ORDER BY chnl_id, int_trans_cd, chnl_trans_txn_amt_sum DESC
  </select>
  
  <resultMap id="ChnlTransMap" type="com.icpay.payment.db.dao.mybatis.model.modelExt.DailyProfitResultChnlTrans">
    <constructor>
      <arg column="chnl_id" javaType="java.lang.String" jdbcType="VARCHAR"/>
      <arg column="int_trans_cd" javaType="java.lang.String" jdbcType="VARCHAR"/>
      <arg column="chnl_trans_txn_amt_sum" javaType="java.math.BigDecimal" jdbcType="DECIMAL"/>
      <arg column="chnl_trans_agent_profit" javaType="java.math.BigDecimal" jdbcType="DECIMAL"/>
      <arg column="chnl_trans_ct_txn_amt_sum" javaType="java.math.BigDecimal" jdbcType="DECIMAL"/>
      <arg column="chnl_trans_huanbi" javaType="java.math.BigDecimal" jdbcType="DECIMAL"/>
      <arg column="chnl_txn_amt_sum" javaType="java.math.BigDecimal" jdbcType="DECIMAL"/>
      <arg column="chnl_agent_profit" javaType="java.math.BigDecimal" jdbcType="DECIMAL"/>
      <arg column="chnl_ct_txn_amt_sum" javaType="java.math.BigDecimal" jdbcType="DECIMAL"/>
      <arg column="chnl_huanbi" javaType="java.math.BigDecimal" jdbcType="DECIMAL"/>
    </constructor>
  </resultMap>
  
</mapper>