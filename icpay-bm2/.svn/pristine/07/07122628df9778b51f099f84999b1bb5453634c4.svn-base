<#include "/common/add_macro.ftl" />
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<@head label="小商户资金池批量配置" base="merCashPool" addSuccMsg="批量新增完成">
			$("#mchntCdsListInpt").validatebox({
				required: true,
				novalidate: true,
				validType: ['maxLength[15000]']
			});
			
			$("#chnlId").validatebox({
				required: true,
				novalidate: true,
				validType: ['maxLength[8]']
			});
		<#--币别变更，资金池也变更为该币别的选项-->
		var lastSelectedItem=null;
		$('#currCd').on('change', function(){
			var selectedItem= $('#currCd').val();

			if (isEmpty(selectedItem)){
				$("#poolId").clearOptions(false);
			}else {
				if (lastSelectedItem != selectedItem){
					onSelectedCurrCdChanged(selectedItem);
				}	
			}
			lastSelectedItem = selectedItem;
		});
			
		function onSelectedCurrCdChanged(selectedCh) {
			$("#poolId").clearOptions(false);
			$.ajax({
				type : "GET",
				url : baseUrl + "/getPoolsByCurrCd.do?currCd="+selectedCh ,
				async: true,
				cache: true,
				success : function(data) {
					var res = parseJson(data);
					if (!checkEmpty(res, "系统异常，请联系管理员！")) return false;
					if (res.respCode != "00"){
						alert("操作失败: "+res.respMsg);
						return false;
					}
					var list = res.respData.poolList;
					if (! isEmpty(list)) {
						for (var i = 0, len = list.length; i < len; i++) {
						  var item = list[i];
						  var currCdesc ='';
						  if(item.currCd == '156'){
						  	currCdesc = '人民币';
						  }else if (item.currCd == '704'){
						  	currCdesc = '越南盾';
						  }else if (item.currCd == '764'){
						  	currCdesc = '泰铢';
						  }
						  $('#poolId').append('<option value="' + item.poolId + '">' + item.poolDesc + '|' + item.poolId +'|'+ currCdesc + '</option>');
						}
					}					
					
				},
				error:function(){
			    	alert("系统异常，请联系管理员！");
			    	return  false;
			    }
			});
		}
			
			
			
		</@head>	
	</head>
	
	<body>
		<@addDiv label="小商户资金池批量配置" addUrl="/merCashPool/batchAddSubmit.do">
			<input type="hidden" id="weightInp" name="weight" value="100" />
			<table class="edit_tbl" cellpadding="0" cellspacing="0">
				<tr>
					<td class="label">前端商户号*：</td>
					<td class="content">
						<textarea cols="50" rows="10" class="easyui-validatebox" maxlength="15000"
							id="mchntCdsListInpt" name="mchntCdsList"  
							placeholder="可输入多个商户号,以「换行」区隔,允许多行输入" >${mchntCdsList!''}</textarea>							
						<span class="inputDesc">可输入多个项目以「换行」区隔，允许多行输入</span>
					</td>
				</tr>
				<tr>
					<td class="label">币别：</td>
					<td class="content">
						<select  name="currCd" id="currCd" >
								<@enumOpts enumNm="CurrencyEnums.CurrType" showEmptyOpt="true" showCode="false"
								selected="${(qryParamMap.currCd)!''}" />
						</select>
					</td>
				</tr>
				<tr>
					<td class="label">资金池名称：</td>
					<td class="content">
						<select id="poolId" name="poolId">
							<option value="">--请选择--</option>						
							<#list poolList as lst>
								<#if (lst.poolId==((qryParamMap.poolId)!''))>
									<option value="${lst.poolId}" selected="selected">${lst.poolDesc}-${lst.currCd}</option>
								<#else>	
									<option value="${lst.poolId}">${lst.poolDesc}-${lst.currCd}</option>
								</#if>	
							</#list>						
						</select>
					</td>
				</tr>
			</table>
		</@addDiv>
	</body>
</html>